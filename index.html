<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STATISTICS_OPS // 統計學戰術測驗系統 v3.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #050510;
            --neon-cyan: #00f3ff;
            --neon-blue: #00aaff;
            --neon-purple: #bc13fe;
            --neon-green: #0aff0a;
            --neon-red: #ff003c;
            --glass-bg: rgba(10, 20, 40, 0.9);
            --grid-color: rgba(0, 243, 255, 0.05);
        }

        * { box-sizing: border-box; user-select: none; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--neon-cyan);
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            /* Cyber Grid Background */
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* Scanline Overlay */
        body::after {
            content: ""; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none; z-index: 999;
        }

        .tech-font { font-family: 'Orbitron', sans-serif; letter-spacing: 2px; }
        .mono-font { font-family: 'Share Tech Mono', monospace; }

        .container {
            max-width: 900px; margin: 0 auto; padding: 20px;
            position: relative; z-index: 10; padding-top: 80px;
        }

        /* Cyber Card Style */
        .cyber-card {
            background: var(--glass-bg);
            border: 1px solid var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
            padding: 30px; margin-bottom: 20px;
            position: relative;
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%);
            backdrop-filter: blur(5px);
        }
        .cyber-card::before {
            content: ""; position: absolute; top: 0; left: 0; width: 20px; height: 20px;
            border-top: 2px solid var(--neon-cyan); border-left: 2px solid var(--neon-cyan);
        }
        .cyber-card::after {
            content: ""; position: absolute; bottom: 0; right: 0; width: 20px; height: 20px;
            border-bottom: 2px solid var(--neon-cyan); border-right: 2px solid var(--neon-cyan);
        }

        h1 { font-size: 2rem; color: #fff; text-align: center; text-shadow: 0 0 10px var(--neon-cyan); margin: 0; }
        h3 { color: #888; text-align: center; letter-spacing: 3px; font-size: 0.9rem; margin-top: 5px; }

        /* Buttons */
        .btn {
            background: rgba(0, 243, 255, 0.1); 
            border: 1px solid var(--neon-cyan); color: var(--neon-cyan);
            padding: 12px 30px; font-family: 'Share Tech Mono'; font-size: 1.2rem;
            cursor: pointer; transition: 0.3s; text-transform: uppercase;
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            margin: 5px;
        }
        .btn:hover { background: var(--neon-cyan); color: #000; box-shadow: 0 0 25px var(--neon-cyan); }
        .btn.secondary { border-color: var(--neon-purple); color: var(--neon-purple); background: rgba(188, 19, 254, 0.1); }
        .btn.secondary:hover { background: var(--neon-purple); color: #fff; box-shadow: 0 0 25px var(--neon-purple); }
        
        /* Options */
        .options-group { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        .option-label {
            display: flex; align-items: center; padding: 15px;
            border: 1px solid rgba(0, 243, 255, 0.3); background: rgba(0, 0, 0, 0.6);
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .option-label:hover { border-color: var(--neon-cyan); background: rgba(0, 243, 255, 0.2); }
        .option-label.selected { background: rgba(0, 243, 255, 0.3); border-color: var(--neon-cyan); box-shadow: inset 0 0 15px rgba(0, 243, 255, 0.2); }
        
        .option-label.correct { border-color: var(--neon-green); background: rgba(10, 255, 10, 0.2); color: var(--neon-green); }
        .option-label.wrong { border-color: var(--neon-red); background: rgba(255, 0, 60, 0.2); color: var(--neon-red); }

        .option-label input { margin-right: 15px; transform: scale(1.2); accent-color: var(--neon-cyan); }

        /* HUD Header */
        #hud-display {
            display: none; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--neon-cyan);
            padding: 10px 20px; position: fixed; top: 0; left: 0; width: 100%; z-index: 100;
        }
        .hud-item { font-family: 'Share Tech Mono'; font-size: 1.2rem; display: flex; flex-direction: column; }
        .hud-label { font-size: 0.7rem; color: #666; letter-spacing: 1px; }

        /* Graphics Area */
        .visual-data-container {
            border: 1px dashed var(--neon-blue);
            background: rgba(0,0,0,0.3);
            padding: 20px; margin: 15px 0;
            text-align: center;
            display: none; /* Show only when needed */
        }
        .visual-label {
            color: var(--neon-blue); font-size: 0.8rem; letter-spacing: 2px; margin-bottom: 10px; display: block;
        }
        svg {
            max-width: 100%; height: auto;
            filter: drop-shadow(0 0 8px rgba(0, 243, 255, 0.3));
        }
        /* Graph Styles matching User Image */
        .graph-line { fill: none; stroke: #00aaff; stroke-width: 3; }
        .graph-axis { stroke: #888; stroke-width: 2; }
        .graph-area { fill: rgba(0, 170, 255, 0.25); }
        .graph-text { fill: #fff; font-size: 16px; font-family: 'Times New Roman', serif; font-style: italic; }
        .graph-label { fill: #aaa; font-size: 14px; font-family: sans-serif; }
        .center-line { stroke: #555; stroke-width: 1; }
        .k-line { stroke: #555; stroke-width: 1.5; }

        /* Screens */
        .screen { display: none; }
        .screen.active { display: block; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        select {
            background: #000; color: var(--neon-cyan); border: 1px solid var(--neon-cyan);
            padding: 10px; width: 100%; font-family: 'Share Tech Mono'; font-size: 1.1rem;
        }

        .grade-S { color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green); }
        .grade-A { color: var(--neon-cyan); }
        .grade-D { color: var(--neon-red); }

        .math { font-family: 'Times New Roman', serif; font-style: italic; }

    </style>
</head>
<body>

    <div id="hud-display">
        <div class="hud-item">
            <span class="hud-label">SYSTEM_CLOCK</span>
            <span id="timer" style="color:#fff">00:00</span>
        </div>
        <div class="hud-item" style="align-items: center;">
            <span class="hud-label">PROGRESS</span>
            <span id="progress">00 / 00</span>
        </div>
        <div class="hud-item" style="align-items: flex-end;">
            <span class="hud-label">PROTOCOL</span>
            <span id="hud-mode" style="color:var(--neon-purple)">STANDBY</span>
        </div>
    </div>

    <div class="container">
        
        <div id="menu-screen" class="screen active cyber-card">
            <h1 class="tech-font">STATISTICS <span style="color:var(--neon-purple)">OPS</span></h1>
            <h3>統計學戰術測驗系統 v3.1</h3>
            <hr style="border:0; border-top:1px solid rgba(0,243,255,0.3); margin:20px 0;">

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <div>
                    <label class="hud-label" style="display:block; margin-bottom:5px;">DATA_VOLUME (題數)</label>
                    <select id="q-count">
                        <option value="10">10 題 (輕量掃描)</option>
                        <option value="25">25 題 (標準作戰)</option>
                        <option value="50">50 題 (全域戰役)</option>
                    </select>
                </div>
                <div>
                    <label class="hud-label" style="display:block; margin-bottom:5px;">TACTIC_MODE (模式)</label>
                    <select id="game-mode">
                        <option value="exam">標準測驗 (EXAM) - 結算成績</option>
                        <option value="practice">即時演練 (PRACTICE) - 立即解析</option>
                    </select>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn" onclick="startSystem()">INITIALIZE (啟動)</button>
            </div>

            <div style="margin-top: 40px;">
                <h4 class="tech-font" style="border-bottom: 1px solid var(--neon-purple); display:inline-block; color:#fff;">RECENT_LOGS</h4>
                <div id="history-list" style="font-size:0.9rem;"></div>
            </div>
        </div>

        <div id="quiz-screen" class="screen cyber-card">
            <div id="visual-container" class="visual-data-container">
                <span id="visual-title" class="visual-label">/// VISUAL_DATA_INTERCEPTED ///</span>
                <div id="visual-content"></div>
            </div>

            <div id="question-text" style="font-size: 1.3rem; margin-bottom: 20px; line-height: 1.6;"></div>
            
            <div id="options-container" class="options-group"></div>

            <div id="practice-feedback" style="display:none; margin-top:20px; padding:15px; border-left:3px solid var(--neon-purple); background:rgba(188,19,254,0.1);">
                <strong id="feedback-status"></strong><br>
                <span id="feedback-text" style="color:#ccc; font-size:0.95rem;"></span>
            </div>

            <div style="margin-top: 30px; text-align: right;">
                <button id="btn-check" class="btn secondary" style="display:none;" onclick="checkPractice()">CONFIRM (確認)</button>
                <button id="btn-next" class="btn" onclick="nextQuestion()">NEXT NODE ></button>
            </div>
        </div>

        <div id="result-screen" class="screen cyber-card">
            <h2 class="tech-font">MISSION REPORT</h2>
            <div style="text-align:center; font-size:4rem; margin:20px 0; color:#fff;" class="tech-font">
                <span id="final-score">0</span>%
            </div>
            <div style="text-align:center; margin-bottom:20px; font-size:1.5rem;">
                RANK: <span id="final-rank">F</span>
            </div>
            
            <div id="error-log" style="max-height:400px; overflow-y:auto; background:rgba(0,0,0,0.5); padding:15px; margin-bottom:20px;"></div>

            <div style="text-align: center;">
                <button class="btn" onclick="returnToMenu()">RETURN TO HUB</button>
            </div>
        </div>

    </div>

    <script>
        // === SVG GENERATOR ===
        // 用程式碼畫出跟您上傳圖片一樣的圖表
        
        function getSVG_Distribution(type, labelValue) {
            // E-1: Normal, Right Tail shaded
            if (type === 'E-1') {
                return `
                <svg viewBox="0 0 320 160" width="320" height="160">
                    <defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#fff" /></marker></defs>
                    <line x1="10" y1="140" x2="310" y2="140" class="graph-axis"/>
                    <path d="M210,95 L210,140 L300,140 C280,140 250,95 210,95 Z" class="graph-area"/>
                    <path d="M20,140 C80,140 120,20 160,20 C200,20 240,140 300,140" class="graph-line"/>
                    <line x1="160" y1="20" x2="160" y2="140" class="center-line"/>
                    <line x1="210" y1="95" x2="210" y2="140" class="k-line"/>
                    <text x="205" y="155" class="graph-text">k</text>
                    <text x="305" y="155" class="graph-text">Z</text>
                    <path d="M260,110 Q245,115 230,125" fill="none" stroke="#fff" marker-end="url(#arrow)"/>
                    <text x="265" y="110" class="graph-text">${labelValue}</text>
                </svg>`;
            } 
            // E-2: T-Dist, Left Side shaded
            else if (type === 'E-2') {
                return `
                <svg viewBox="0 0 320 160" width="320" height="160">
                    <defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#fff" /></marker></defs>
                    <line x1="10" y1="140" x2="310" y2="140" class="graph-axis"/>
                    <path d="M20,140 C80,140 120,20 160,20 C180,20 200,60 210,95 L210,140 L20,140 Z" class="graph-area"/>
                    <path d="M20,140 C80,140 120,20 160,20 C200,20 240,140 300,140" class="graph-line"/>
                    <line x1="160" y1="20" x2="160" y2="140" class="center-line"/>
                    <line x1="210" y1="95" x2="210" y2="140" class="k-line"/>
                    <text x="205" y="155" class="graph-text">k</text>
                    <text x="305" y="155" class="graph-text">T</text>
                    <path d="M100,100 Q130,110 145,120" fill="none" stroke="#fff" marker-end="url(#arrow)"/>
                    <text x="50" y="100" class="graph-text">${labelValue}</text>
                </svg>`;
            }
            // E-3: Chi-Square, Left Tail shaded
            else if (type === 'E-3') {
                return `
                <svg viewBox="0 0 320 160" width="320" height="160">
                    <defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#fff" /></marker></defs>
                    <line x1="10" y1="140" x2="310" y2="140" class="graph-axis"/>
                    <path d="M20,140 Q25,80 40,55 L40,140 Z" class="graph-area"/>
                    <path d="M20,140 Q30,20 80,40 T300,140" class="graph-line"/>
                    <line x1="40" y1="55" x2="40" y2="140" class="k-line"/>
                    <text x="35" y="155" class="graph-text">k</text>
                    <text x="300" y="150" class="graph-text" font-family="Times New Roman">χ²</text>
                    <path d="M10,80 Q25,90 35,100" fill="none" stroke="#fff" marker-end="url(#arrow)"/>
                    <text x="5" y="75" class="graph-text">${labelValue}</text>
                </svg>`;
            }
        }

        // === DATA BANK ===
      const questionBank = [
    // --- Page 1: 機率與分配 (Probability & Distributions) ---
    {
        id: "q1",
        question: "1. 試判斷下列哪一個圖形「不是」機率分配？(提示：機率總和需為1且函數值恆正)",
        options: ["圖形 A", "圖形 B", "圖形 C", "圖形 D (函數值含負值或面積不為1)"],
        answer: 3,
        explanation: "機率密度函數 (PDF) 的兩大條件：1. 函數值恆大於等於 0；2. 總面積 (機率總和) 必須等於 1。"
    },
    {
        id: "q2",
        question: "2. 設隨機變數 Z 服從標準常態分配，試求出滿足 [圖 E-1] 中陰影區域面積為 0.2266 的 k 值為何？",
        visual: "E-1", visualLabel: "0.2266", visualTitle: "/// 圖 E-1 (FIGURE E-1) ///",
        options: ["1.21", "0.52", "0.75", "2.25"],
        answer: 2,
        explanation: "圖 E-1 顯示右尾面積為 0.2266，代表左側累積機率為 1 - 0.2266 = 0.7734。查 Z 表可知 Z(0.7734) ≈ 0.75。"
    },
    {
        id: "q3",
        question: "3. 設隨機變數 T 服從自由度為 10 的 t 分配，試求出滿足 [圖 E-2] 的 k 值為何？(左側面積為 0.975)",
        visual: "E-2", visualLabel: "0.975", visualTitle: "/// 圖 E-2 (FIGURE E-2) ///",
        options: ["1.372", "1.812", "2.228", "3.169"],
        answer: 2,
        explanation: "圖 E-2 顯示 k 左側面積為 0.975，即 k 為第 97.5 百分位數。查 t 表 (df=10, α=0.025) 可得 t=2.228。"
    },
    {
        id: "q4",
        question: "4. 設隨機變數服從自由度 20 的卡方分配，試求出滿足 [圖 E-3] 的 k 值為何？(左側面積為 0.1)",
        visual: "E-3", visualLabel: "0.1", visualTitle: "/// 圖 E-3 (FIGURE E-3) ///",
        options: ["10.851", "12.443", "31.410", "37.566"],
        answer: 1,
        explanation: "圖 E-3 顯示 k 左側累積機率為 0.1。查卡方表 (df=20) 的左尾 0.1 (或右尾 0.9)，對應數值約為 12.443。"
    },
    {
        id: "q5",
        question: "5. 已知 <span class='math'>Z ~ N(0,1)</span>，試求 <span class='math'>P(-2 ≤ Z ≤ 2)</span> 的機率為何？",
        options: ["0.6826", "0.9545", "0.9974", "1"],
        answer: 1,
        explanation: "根據常態分配經驗法則 (Empirical Rule)，平均數加減 2 個標準差內的機率約為 0.9545。"
    },
    {
        id: "q6",
        question: "6. 某班有 100 位同學，期中考成績服從平均數 70 分，標準差 10 分的常態分配，試問全班同學期中考的中位數為何？",
        options: ["70分", "80分", "85分", "資訊不足，無法判斷"],
        answer: 0,
        explanation: "常態分配是對稱分配，平均數 = 中位數 = 眾數。故中位數為 70。"
    },
    {
        id: "q7",
        question: "7. (續上題) 試問全班同學期中考的眾數為何？",
        options: ["70分", "80分", "85分", "資訊不足，無法判斷"],
        answer: 0,
        explanation: "常態分配是對稱分配，平均數 = 中位數 = 眾數。故眾數為 70。"
    },
    {
        id: "q8",
        question: "8. (續上題) 小明同學考了 60 分，試問他的標準化分數 (Z-score) 為何？",
        options: ["1", "-1", "2", "-2"],
        answer: 1,
        explanation: "Z = (X - μ) / σ = (60 - 70) / 10 = -1。"
    },
    {
        id: "q9",
        question: "9. 設隨機變數 X ~ N(8,5)，試問 P(X=7) 的機率為何？(提示：連續型單點機率)",
        options: ["0.1587", "0", "0.6826", "0.8413"],
        answer: 1,
        explanation: "連續型隨機變數在任何「單點」的機率皆為 0。"
    },
    {
        id: "q10",
        question: "10. 下列哪一個分配「不是」對稱分配？",
        options: ["常態分配", "標準常態分配", "t 分配", "卡方分配"],
        answer: 3,
        explanation: "卡方分配 (Chi-square) 為右偏分配，不對稱。"
    },

    // --- Page 2: 抽樣方法 (Sampling Methods) ---
    {
        id: "q11",
        question: "11. 下列哪一個「不是」隨機樣本的必要條件？",
        options: ["樣本要抽自相同母體", "樣本間要相互獨立", "要採隨機抽樣進行抽樣", "母體一定要常態母體"],
        answer: 3,
        explanation: "隨機樣本 (i.i.d.) 僅要求獨立且來自同一母體，並不要求母體本身必須是常態分配。"
    },
    {
        id: "q12",
        question: "12. 高雄市政府由 38 個區中隨機各抽取 3 個里，共 114 個里進行普查，試問這是何種抽樣方法？",
        options: ["簡單隨機抽樣", "分層抽樣", "系統抽樣", "集群抽樣"],
        answer: 1,
        explanation: "將母體分為 38 層 (區)，再從每層中抽取樣本 (里)，屬於分層抽樣。"
    },
    {
        id: "q13",
        question: "13. 將 250 位同學編號，每 25 位一組(A~J)，由 A 組隨機抽 1 號後，依序每加 25 號抽取下一位，試問這是何種抽樣方法？",
        options: ["簡單隨機抽樣", "分層抽樣", "系統抽樣", "集群抽樣"],
        answer: 2,
        explanation: "固定間隔 (每 25 號) 進行抽樣，屬於系統抽樣。"
    },
    {
        id: "q14",
        question: "14. 某校欲瞭解大學生對議題看法，在校園看到同學就問，試問這是何種抽樣方法？",
        options: ["便利抽樣", "立意抽樣", "配額抽樣", "滾雪球抽樣"],
        answer: 0,
        explanation: "根據方便性，遇到誰就問誰，屬於便利抽樣 (非隨機)。"
    },
    {
        id: "q15",
        question: "15. 抽樣分配 (Sampling Distribution) 指的是哪一個數的機率分配？",
        options: ["母體平均數", "樣本平均數 X̄", "母體變異數", "母體比例 P"],
        answer: 1,
        explanation: "抽樣分配是指「統計量」(如樣本平均數 X̄) 的機率分配。"
    },
    {
        id: "q16",
        question: "16. 母體 X~N(75, 5)，隨機抽取 n=25 的樣本，試問 X̄ 的平均數為何？",
        options: ["75", "3", "5", "1"],
        answer: 0,
        explanation: "樣本平均數的期望值等於母體平均數，E(X̄) = μ = 75。"
    },
    {
        id: "q17",
        question: "17. (續上題) 試問 X̄ 的標準差 (標準誤) 為何？",
        options: ["75", "3", "5", "1"],
        answer: 3,
        explanation: "標準誤 SE = σ / √n = 5 / √25 = 5 / 5 = 1。"
    },
    {
        id: "q18",
        question: "18. (續上題) 試問 P(X̄=77) 的機率為何？",
        options: ["0", "0.0228", "0.9772", "1"],
        answer: 0,
        explanation: "抽樣分配 X̄ 仍為連續型分配，單點機率為 0。"
    },
    {
        id: "q19",
        question: "19. 依據中央極限定理，當下列哪一個條件成立時，任何統計量的機率分配都會近似常態分配？",
        options: ["樣本數夠大", "樣本平均數夠大", "樣本標準差夠大", "樣本變異數夠大"],
        answer: 0,
        explanation: "中央極限定理 (CLT) 指出當「樣本數 n 夠大」(通常 n ≥ 30) 時，樣本平均數的分配會近似常態。"
    },

    // --- Page 3: 信賴區間 (Confidence Intervals) ---
    {
        id: "q20",
        question: "20. 已知 X̄ 的變異數為 0.5 (母體 SD=5)，試問所抽的樣本數 n 為何？",
        options: ["5", "25", "50", "100"],
        answer: 2,
        explanation: "Var(X̄) = σ² / n => 0.5 = 25 / n => n = 50。"
    },
    {
        id: "q21",
        question: "21. 在信賴水準固定下，如果增加樣本數，則信賴區間的長度會如何變化？",
        options: ["變長", "變短", "不變", "無法判斷"],
        answer: 1,
        explanation: "區間長度與 1/√n 成反比。樣本數增加，標準誤變小，區間變短。"
    },
    {
        id: "q22",
        question: "22. 在其他條件不變之下，如果信賴區間長度變長，則信賴水準會如何變化？",
        options: ["變大", "變小", "不變", "無法判斷"],
        answer: 0,
        explanation: "區間越寬，包含真實參數的機率 (信心水準) 越高。"
    },
    {
        id: "q23",
        question: "23. 在相同的信賴水準下，下列有關信賴區間的敘述何者為真？",
        options: ["樣本數越多，信賴區間長度越長", "信賴區間越長，估計誤差越小", "樣本數越大，估計誤差越大", "以上皆非"],
        answer: 3,
        explanation: "正確觀念應為：樣本數越多，估計誤差越小，信賴區間越短。故選 (D) 以上皆非。"
    },
    {
        id: "q24",
        question: "24. 95% 信賴區間為 (235.8, 314.2)，試問樣本平均消費金額為何？",
        options: ["150", "175", "275", "250"],
        answer: 2,
        explanation: "樣本平均數為信賴區間的中點：(235.8 + 314.2) / 2 = 275。"
    },
    {
        id: "q25",
        question: "25. (續上題) 試問抽取 100 位民眾消費金額的標準差 S 為何？",
        options: ["100", "200", "300", "400"],
        answer: 1,
        explanation: "誤差 E = (314.2 - 235.8)/2 = 39.2。E = 1.96 * (S/√n) => 39.2 = 1.96 * (S/10) => S/10 = 20 => S = 200。"
    },
    {
        id: "q26",
        question: "26. (續上題) 試問估計的 95% 誤差界限 (Margin of Error) 為何？",
        options: ["39.2", "19.6", "78.4", "58.8"],
        answer: 0,
        explanation: "誤差界限 = (上限 - 下限) / 2 = 78.4 / 2 = 39.2。"
    },
    {
        id: "q27",
        question: "27. (續上題) 試問估計的信賴區間長度為何？",
        options: ["39.2", "19.6", "78.4", "58.8"],
        answer: 2,
        explanation: "區間長度 = 上限 - 下限 = 314.2 - 235.8 = 78.4。"
    },

    // --- Page 4: 假設檢定-單樣本 (Hypothesis Testing - One Sample) ---
    {
        id: "q28",
        question: "28. 支持比例的 95% 信賴區間為 (0.68, 0.74)，試問支持比例 p̂ 為何？",
        options: ["0.68", "0.71", "0.72", "0.74"],
        answer: 1,
        explanation: "樣本比例為區間中點：(0.68 + 0.74) / 2 = 0.71。"
    },
    {
        id: "q29",
        question: "29. (續上題) 試問此次調查中的估計誤差為多少？",
        options: ["0.06", "0.05", "0.04", "0.03"],
        answer: 3,
        explanation: "估計誤差 = (0.74 - 0.68) / 2 = 0.03。"
    },
    {
        id: "q30",
        question: "30. (續上題) 試問信賴區間的長度為多少？",
        options: ["0.06", "0.05", "0.04", "0.03"],
        answer: 0,
        explanation: "區間長度 = 0.74 - 0.68 = 0.06。"
    },
    {
        id: "q31",
        question: "31. 考慮檢定的假設為 H0: μ ≤ 21 vs. H1: μ > 21，此檢定類型為何？",
        options: ["左尾檢定", "右尾檢定", "雙尾檢定", "以上皆是"],
        answer: 1,
        explanation: "H1 為「大於 (>)」，故為右尾檢定。"
    },
    {
        id: "q32",
        question: "32. 考慮檢定的假設為 H0: μ = 21 vs. H1: μ ≠ 21，則拒絕域應該是哪個圖形？",
        options: ["圖形 A (左尾)", "圖形 B (右尾)", "圖形 C (雙尾)", "以上皆可"],
        answer: 2,
        explanation: "H1 為「不等於 (≠)」，故為雙尾檢定。"
    },
    {
        id: "q33",
        question: "33. 考慮 H0: μ ≤ 21 vs. H1: μ > 21，如果母體平均數 μ = 23 (H1為真)，若檢定結果接受 H0，則發生何種錯誤？",
        options: ["型 I 誤差", "型 II 誤差", "兩者都會發生", "都不會發生"],
        answer: 1,
        explanation: "H1 為真卻沒有拒絕 H0 (接受了錯誤的 H0)，這是犯了型 II 誤差 (Type II Error)。"
    },
    {
        id: "q34",
        question: "34. 下列對型 I 誤差的描述，何者正確？",
        options: ["接受了錯的 H0", "拒絕了對的 H0", "接受了對的 H0", "拒絕了錯的 H0"],
        answer: 1,
        explanation: "型 I 誤差定義：當 H0 為真 (對的) 時，卻拒絕了它。"
    },
    {
        id: "q35",
        question: "35. 如果一假設檢定的統計決策為「拒絕虛無假設 (Reject H0)」，則這個決策可能會？",
        options: ["犯型 I 誤差", "犯型 II 誤差", "同時犯型 I 與型 II 誤差", "都不會犯錯"],
        answer: 0,
        explanation: "拒絕 H0 時，風險在於「H0 其實是真的」，這就是型 I 誤差的定義。"
    },
    {
        id: "q36",
        question: "36. 颱風假假設 H0:放假 vs H1:不放假。「該放假而沒放假」(即 H0 為真卻拒絕了它) 會犯何種錯誤？",
        options: ["型 I 誤差", "型 II 誤差", "同時犯錯", "都不會犯錯"],
        answer: 0,
        explanation: "H0 為真 (該放假)，但決策為 H1 (不放假/拒絕 H0)，這是拒絕了正確的 H0，故為型 I 誤差。"
    },
    {
        id: "q37",
        question: "37. 已知母體標準差。抽取 25 人，平均 52。檢定 H0: μ ≤ 5 vs H1: μ > 5。檢定統計量分配為何？",
        options: ["F 分配", "卡方分配", "t 分配", "Z 分配"],
        answer: 3,
        explanation: "母體標準差已知，無論樣本數大小 (常態母體下)，使用 Z 分配。"
    },
    {
        id: "q38",
        question: "38. 母體標準差未知。抽取 25 人，平均 52，s=4.5。檢定 H0: μ ≤ 50 vs H1: μ > 50。檢定統計量分配為何？",
        options: ["F 分配", "卡方分配", "t 分配", "Z 分配"],
        answer: 2,
        explanation: "母體標準差未知且樣本數小 (n<30)，使用 t 分配。"
    },
    {
        id: "q39",
        question: "39. (續上題) 試問拒絕域為何？ (α=0.05, 單尾)",
        options: ["|Z| ≥ 1.96", "|Z| ≥ 1.645", "|T| ≥ 2.064", "T ≥ 1.711"],
        answer: 3,
        explanation: "t 分配，df = n-1 = 24，單尾 α=0.05。查表 T > 1.711。"
    },
    {
        id: "q40",
        question: "40. 抽取 1,000 位同學，450 位騎機車，p 的點估計值為何？",
        options: ["0.55", "0.5", "0.45", "不知道"],
        answer: 2,
        explanation: "點估計 p̂ = x / n = 450 / 1000 = 0.45。"
    },

    // --- Page 5: 假設檢定-雙樣本 (Hypothesis Testing - Two Samples) ---
    {
        id: "q41",
        question: "41. 探討「男、女利用網路購物金額是否有差異」，檢定參數為何？",
        options: ["p1 - p2", "μ1 - μ2", "σ1 - σ2", "σ1² - σ2²"],
        answer: 1,
        explanation: "消費「金額」為連續數值資料，比較兩組平均差異，使用 μ1 - μ2。"
    },
    {
        id: "q42",
        question: "42. 若要檢定「男性網購比例 (p1) 低於女性 (p2)」的假設，應建立為何？",
        options: ["H1: p1 ≠ p2", "H1: p1 > p2", "H1: p1 < p2", "以上皆非"],
        answer: 2,
        explanation: "研究假設 (H1) 設定為想要證明的方向，「低於」即為 p1 < p2。"
    },
    {
        id: "q43",
        question: "43. (續上題: 男45/150, 女100/200) 試問樣本比例差 p̂1 - p̂2 的值為何？",
        options: ["0.3", "0.5", "0.2", "-0.2"],
        answer: 3,
        explanation: "p̂1 = 45/150 = 0.3; p̂2 = 100/200 = 0.5。差值 = 0.3 - 0.5 = -0.2。"
    },
    {
        id: "q44",
        question: "44. 兩母體 N(μ1, σ), N(μ2, σ) (變異數相等但未知)，小樣本。檢定 μ1=μ2，檢定統計量分配為何？",
        options: ["F 分配", "卡方分配", "t 分配", "Z 分配"],
        answer: 2,
        explanation: "雙母體平均數檢定，變異數未知且小樣本，使用 t 分配。"
    },
    {
        id: "q45",
        question: "45. (續上題 n1=12, n2=10) 試問檢定統計量的自由度為何？",
        options: ["20", "12", "10", "沒有自由度"],
        answer: 0,
        explanation: "自由度 df = n1 + n2 - 2 = 12 + 10 - 2 = 20。"
    },
    {
        id: "q46",
        question: "46. 兩獨立常態母體 N(56, 2.4) 與 N(48, 2.5)，n1=16, n2=25。試問樣本平均數差的平均數為何？",
        options: ["56", "48", "8", "114"],
        answer: 2,
        explanation: "樣本平均數差的期望值 = 母體平均數差 = 56 - 48 = 8。"
    },
    {
        id: "q47",
        question: "47. (續上題) 試問樣本平均數差的變異數為何？(σ 已知)",
        options: ["2.4", "0.61", "0.78", "2.5"],
        answer: 1,
        explanation: "Var(X̄ - Ȳ) = σ1²/n1 + σ2²/n2 = 2.4²/16 + 2.5²/25 = 0.36 + 0.25 = 0.61。"
    },
    {
        id: "q48",
        question: "48. 樣本 1 (n=16, s²=5.25) 與 樣本 2 (n=10, s²=4.75)，試問樣本聯合變異數 (Pooled Variance) 為何？",
        options: ["2.249", "5.058", "5.0625", "2.25"],
        answer: 2,
        explanation: "Sp² = [(n1-1)s1² + (n2-1)s2²] / (n1+n2-2) = [15*5.25 + 9*4.75] / 24 = (78.75 + 42.75) / 24 = 5.0625。"
    },
    {
        id: "q49",
        question: "49. (續上題) 如果要檢定兩母體平均數是否相等，試問檢定統計量的抽樣分配為何？",
        options: ["Z 分配", "t 分配", "卡方分配", "F 分配"],
        answer: 1,
        explanation: "變異數未知，使用 t 分配。"
    },
    {
        id: "q50",
        question: "50. (續上題) 若要檢定兩母體平均數是否相等 (雙尾, α=0.05)，則其拒絕域為何？",
        options: ["|Z| ≥ 1.96", "|Z| ≥ 1.645", "|T| ≥ 2.064", "|T| ≥ 1.711"],
        answer: 2,
        explanation: "df = 16+10-2 = 24。雙尾 α=0.05 (單尾 0.025)，查 t 表得臨界值 2.064。"
    }
];

        // === SYSTEM LOGIC ===
        let currentQuestions = [];
        let currentIndex = 0;
        let timerInterval;
        let secondsElapsed = 0;
        let userAnswers = {}; 
        let mode = 'exam';
        let isPracticeChecked = false;
        // === 新增功能：處理題目分組與文字清理 ===
    function getShuffledGroupedQuestions(bank) {
        // 1. 定義續上題的關鍵字
        const continuationKeywords = ["續上題", "承上題", "接上題"];
        
        let groups = [];
        let currentGroup = [];

        bank.forEach((q) => {
            // A. 清理題目文字：移除 "Q48 question:" 或 "48." 這種開頭
            // Regex 邏輯：匹配 (Q數字 question:) 或 (數字.) 開頭並移除
            let cleanText = q.question.replace(/^\s*(?:[Qq]\d+\s*question:|\d+\.?)\s*/i, "");
            
            // 複製題目物件以免修改到原始資料
            let processedQ = { ...q, question: cleanText };

            // B. 判斷是否屬於上一題的延續
            let isContinuation = continuationKeywords.some(kw => cleanText.includes(kw));

            if (isContinuation && currentGroup.length > 0) {
                // 如果是續上題，加入目前的群組（綁定在一起）
                currentGroup.push(processedQ);
            } else {
                // 如果不是續上題（是新題目）
                // 先把舊的群組存進去
                if (currentGroup.length > 0) {
                    groups.push(currentGroup);
                }
                // 開啟新的群組
                currentGroup = [processedQ];
            }
        });
        // 迴圈結束後，存入最後一組
        if (currentGroup.length > 0) groups.push(currentGroup);

        // 2. 對「群組」進行洗牌 (這樣 Q48, Q49, Q50 會整組移動，順序不變)
        for (let i = groups.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [groups[i], groups[j]] = [groups[j], groups[i]];
        }

        // 3. 攤平回傳 (變成一維陣列供系統使用)
        return groups.flat();
    }
      function startSystem() {
        const count = parseInt(document.getElementById('q-count').value);
        mode = document.getElementById('game-mode').value;
        
        // === 修改這裡 START (替換原本的 Randomize 迴圈) ===
        // 使用新的函式取得「已洗牌但保持連續性」的題庫
        let pool = getShuffledGroupedQuestions(questionBank);
        // === 修改這裡 END ===

        // 確保題目數不超過 pool 長度
        const safeCount = Math.min(count, pool.length);
        currentQuestions = pool.slice(0, safeCount);
        
        currentIndex = 0; userAnswers = {}; secondsElapsed = 0; isPracticeChecked = false;
        
        document.getElementById('hud-mode').innerText = mode.toUpperCase();
        document.getElementById('hud-display').style.display = 'flex';
        switchScreen('quiz-screen');
        startTimer();
        renderQuestion();
    }

        function renderQuestion() {
            const q = currentQuestions[currentIndex];
            const total = currentQuestions.length;
            
            document.getElementById('progress').innerText = `${String(currentIndex + 1).padStart(2,'0')} / ${String(total).padStart(2,'0')}`;
            
            // Visual Data
            const visualContainer = document.getElementById('visual-container');
            if (q.visual) {
                visualContainer.style.display = 'block';
                document.getElementById('visual-title').innerText = q.visualTitle;
                document.getElementById('visual-content').innerHTML = getSVG_Distribution(q.visual, q.visualLabel);
            } else {
                visualContainer.style.display = 'none';
            }

            document.getElementById('question-text').innerHTML = q.question;

            // Options
            const optsContainer = document.getElementById('options-container');
            optsContainer.innerHTML = '';
            
            q.options.forEach((opt, idx) => {
                const label = document.createElement('label');
                label.className = 'option-label';
                label.onclick = () => selectOption(idx);
                const input = document.createElement('input');
                input.type = 'radio'; input.name = 'opt'; input.value = idx;
                
                if (userAnswers[q.id] === idx) {
                    input.checked = true; label.classList.add('selected');
                }
                
                if (mode === 'practice' && isPracticeChecked) {
                    input.disabled = true; label.style.cursor = 'default';
                    if (idx === q.answer) label.classList.add('correct');
                    else if (userAnswers[q.id] === idx) label.classList.add('wrong');
                }

                label.appendChild(input);
                label.appendChild(document.createTextNode(opt));
                optsContainer.appendChild(label);
            });

            // Buttons
            const feedback = document.getElementById('practice-feedback');
            feedback.style.display = 'none';
            const btnCheck = document.getElementById('btn-check');
            const btnNext = document.getElementById('btn-next');

            if (mode === 'practice') {
                if (isPracticeChecked) {
                    feedback.style.display = 'block';
                    const isCorrect = userAnswers[q.id] === q.answer;
                    document.getElementById('feedback-status').innerHTML = isCorrect ? 
                        `<span style="color:var(--neon-green)">[CORRECT] 參數正確</span>` : 
                        `<span style="color:var(--neon-red)">[ERROR] 參數錯誤</span>`;
                    document.getElementById('feedback-text').innerText = q.explanation;
                    btnCheck.style.display = 'none'; btnNext.style.display = 'inline-block';
                } else {
                    btnCheck.style.display = 'inline-block'; btnNext.style.display = 'none';
                }
            } else {
                btnCheck.style.display = 'none'; btnNext.style.display = 'inline-block';
                btnNext.innerText = (currentIndex === total - 1) ? 'SUBMIT (交卷)' : 'NEXT NODE >';
            }
        }

        function selectOption(idx) {
            if (mode === 'practice' && isPracticeChecked) return;
            const qId = currentQuestions[currentIndex].id;
            userAnswers[qId] = idx;
            document.querySelectorAll('.option-label').forEach(l => l.classList.remove('selected'));
            document.querySelectorAll('input[name="opt"]')[idx].checked = true;
            document.querySelectorAll('.option-label')[idx].classList.add('selected');
        }

        function checkPractice() {
            const qId = currentQuestions[currentIndex].id;
            if (userAnswers[qId] === undefined) { alert("WARNING: No Input Data."); return; }
            isPracticeChecked = true; renderQuestion();
        }

        function nextQuestion() {
            if (mode === 'exam' && userAnswers[currentQuestions[currentIndex].id] === undefined) {
                if(!confirm("ALERT: 當前節點無數據。確定跳過？")) return;
            }
            if (currentIndex < currentQuestions.length - 1) {
                currentIndex++; isPracticeChecked = false; renderQuestion();
            } else {
                finishExam();
            }
        }

        function finishExam() {
            clearInterval(timerInterval);
            document.getElementById('hud-display').style.display = 'none';
            switchScreen('result-screen');

            let correct = 0; let logHtml = '';
            currentQuestions.forEach((q, i) => {
                const myAns = userAnswers[q.id];
                if (myAns === q.answer) correct++;
                else {
                    const myText = myAns !== undefined ? q.options[myAns] : "無訊號";
                    logHtml += `<div style="border-bottom:1px dashed #555; padding:10px 0;">
                        <div style="color:#fff; margin-bottom:5px;">Q: ${q.question}</div>
                        <div style="color:var(--neon-red)">You: ${myText}</div>
                        <div style="color:var(--neon-green)">Ans: ${q.options[q.answer]}</div>
                        <div style="color:#aaa; font-size:0.85rem; margin-top:5px;">解析: ${q.explanation}</div>
                    </div>`;
                }
            });

            if (logHtml === '') logHtml = '<div style="text-align:center; color:var(--neon-green); margin-top:20px;">PERFECT SYNCHRONIZATION. 無異常數據。</div>';
            document.getElementById('error-log').innerHTML = logHtml;
            
            const score = Math.round((correct / currentQuestions.length) * 100);
            document.getElementById('final-score').innerText = score;
            let rank = score >= 90 ? 'S' : (score >= 80 ? 'A' : (score >= 60 ? 'B' : 'F'));
            document.getElementById('final-rank').innerText = rank;
            document.getElementById('final-rank').className = `grade-${rank}`;
            
            saveHistory(score, rank, currentQuestions.length);
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                secondsElapsed++;
                const m = Math.floor(secondsElapsed / 60).toString().padStart(2, '0');
                const s = (secondsElapsed % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            }, 1000);
        }

        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
            if (id === 'menu-screen') renderHistory();
        }

        function returnToMenu() { switchScreen('menu-screen'); }

        function saveHistory(score, rank, total) {
            const h = JSON.parse(localStorage.getItem('stats_ops_history') || '[]');
            h.unshift({
                date: new Date().toLocaleString('zh-TW', {month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit'}),
                score: score, rank: rank, total: total, mode: mode
            });
            if(h.length > 10) h.pop();
            localStorage.setItem('stats_ops_history', JSON.stringify(h));
        }

        function renderHistory() {
            const h = JSON.parse(localStorage.getItem('stats_ops_history') || '[]');
            const list = document.getElementById('history-list');
            if (h.length === 0) { list.innerHTML = '<div style="text-align:center; color:#555; padding:10px;">[ NO DATA LOGS ]</div>'; return; }
            let html = '<table style="width:100%; border-collapse:collapse;">';
            h.forEach(rec => {
                let color = rec.rank === 'S' || rec.rank === 'A' ? 'var(--neon-green)' : (rec.rank === 'F' ? 'var(--neon-red)' : '#fff');
                html += `<tr style="border-bottom:1px solid #333;"><td style="padding:8px;">${rec.date}</td><td>${rec.mode.toUpperCase()}</td><td style="color:${color}; font-weight:bold;">${rec.rank}</td><td style="text-align:right;">${rec.score}</td></tr>`;
            });
            list.innerHTML = html + '</table>';
        }

        window.onload = renderHistory;
    </script>
</body>
</html>
